<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>test</title>
</head>
<body >
	
<button type="button" onclick="setData()">set</button>
<button type="button" onclick="getData()">get</button>
<button type="button" onclick="add()">add</button>

</body>
<script type="text/javascript">
	var $scope = new Object();

	$scope = {
		'customer':{
			'mobile':13338030708,
			'addressAry':[
				{	
					'address':'张家港市',
					'coordinate':'12.3,12.5'
				},
				{	
					'address':'张家港市',
					'coordinate':'12.3,12.5'
				}
			]
		},
		'buyer':{
			'mobile':13338030708,
			'addressAry':[
				{	
					'address,ok':'张家港市',
					'coordinate':'12.3,12.5'
				},
				{	
					'address':'张家港市',
					'coordinate':'12.3,12.5'
				}
			]
		}
	};

	var $FACTORY_SPLIT = function(keyStack,keyStackAry,obj){
		if(keyStack.length > 0){
			keyStackAry.push(keyStack);
		}
		if(obj && obj instanceof Object){
			for(var key in obj){
				var nextKeyStack = [];
				for(var i=0;i<keyStack.length;i++){
					nextKeyStack.push(keyStack[i]);
				}
				nextKeyStack.push(key);
				$FACTORY_SPLIT(nextKeyStack,keyStackAry,obj[key]);
			}
		}
	}

	

	var $FACTORY = function(obj){
		var keyStackAry = [];
		$FACTORY_SPLIT([],keyStackAry,obj);
		//要倒着来一个一个转化
		for(var i=keyStackAry.length-1;i>=0;i--){
			var keyStack = keyStackAry[i];
			//直接执行变量的set get转化，狸猫换太子
			var cmd_1 = 'delete obj';
			var cmd_2 = '';//中间部分
			for(var k=0;k<keyStack.length-1;k++){
				if(isNaN(keyStack[k])){
					cmd_2 = cmd_2+'[\''+keyStack[k]+'\']';
				}else{
					cmd_2 = cmd_2+'['+keyStack[k]+']';
				}
			}
			var cmd_3 = '';//最后一级，就是要替换的那一级变量
			var lastKey = keyStack[keyStack.length-1];//最后一级变量名
			if(isNaN(lastKey)){
				cmd_3 = '[\''+lastKey+'\']';
			}else{
				cmd_3 = '['+lastKey+']';
			}
			var newLastKey = '_'+lastKey;//前置一个下划线
			var newCmd_3 = '[\''+newLastKey+'\']';
			var val = eval('obj'+cmd_2+cmd_3);//留下数据
			eval(cmd_1+cmd_2+cmd_3);//删除原本的变量
			eval('obj'+cmd_2+newCmd_3+'=val');//换成新名字

			//进行set get监听
			var parentObj = eval('obj'+cmd_2);
			Object.defineProperty(parentObj,lastKey,{
				set:function(newValue){
					console.log("set");
					if(newValue){
						$FACTORY(newValue);
					}
					this[newLastKey] = newValue;
				},
				get:function(){
					console.log("get");
					return this[newLastKey];
				}
			});
		}
	}

	$FACTORY($scope);
	console.log("=========");
	console.log($scope);

	
	function setData(){
		$scope.customer.mobile = {
			"name":"t-"+new Date().getTime()
		};
	}

	function getData(){
		console.log($scope.customer);
	}

	function add(){
		$scope.customer.addressAry[0] = {};
	}
</script>


</html>