'use strict';var $NICE_MVVM=new Object();var $nc=new Object();var $WATCH_QUEE={};var $watch=function(proPathAry,fun){for(var i=0;i<proPathAry.length;i++){if(!$WATCH_QUEE[proPathAry[i]]){$WATCH_QUEE[proPathAry[i]]=[]}$WATCH_QUEE[proPathAry[i]].push({'proPathAry':proPathAry,'fun':fun})}};var $AFTER_RENDER=null;var $onload=function(fun){$AFTER_RENDER=fun};var $AFTER_FLUSH=null;var $onflush=function(fun){$AFTER_FLUSH=fun};window.onload=function(){var $SCOPE={'$DATA':$nc};var $SCOPE_DATA_=new Object();$SCOPE.$NODE_ID_POINT=0;$SCOPE.$UNREFRESH_NODE_ID=-1;$SCOPE.$V2M_NODE_MAP=new Object();$SCOPE.$ADD_V2M_NODE_MAP=function(expression,nodePack){expression=expression.replace(/\[/g,'.');expression=expression.replace(/\]/g,'');expression=expression.replace(/\.indexOf\(/g,' ');expression=expression.replace(/\.substring\(/g,' ');expression=expression.replace(/\.substr\(/g,' ');expression=expression.replace(/\.subStr\(/g,' ');expression=expression.replace(/\.charAt\(/g,' ');expression=expression.replace(/\.lastIndexOf\(/g,' ');expression=expression.replace(/\.match\(/g,' ');expression=expression.replace(/\.search\(/g,' ');expression=expression.replace(/\.slice\(/g,' ');expression=expression.replace(/\.split\(/g,' ');expression=expression.replace(/\.split\(/g,' ');expression=expression.replace(/\.length\(/g,' ');expression=expression.replace(/\.toLowerCase\(/g,' ');expression=expression.replace(/\.toUpperCase\(/g,' ');expression=expression.replace(/\.replace\(/g,' ');expression=expression.replace(/\.length/g,' ');var find=false;for(var pro in $SCOPE_DATA_){if(expression.indexOf(pro)>=0){if(expression.indexOf('.'+pro)<0&&expression.indexOf(pro+'.')<0){if(!$SCOPE.$V2M_NODE_MAP[pro]){$SCOPE.$V2M_NODE_MAP[pro]=[]}find=true;$SCOPE.$V2M_NODE_MAP[pro].push($SCOPE.$COPY_NODE_PACK(nodePack))}}}if(!find){var proReg=new RegExp(expression+'\\.[0-9]+\\..*');for(var pro in $SCOPE_DATA_){if(proReg.test(pro)){if(!$SCOPE.$V2M_NODE_MAP[expression]){$SCOPE.$V2M_NODE_MAP[expression]=[]}$SCOPE.$V2M_NODE_MAP[expression].push($SCOPE.$COPY_NODE_PACK(nodePack));find=true;break}}}if(!find){try{var val=eval(expression);nodePack.render(expression,val)}catch(err){}}};$SCOPE.$COPY_NODE_PACK=function(nodePack){var newNodePack=new Object();for(var key in nodePack){newNodePack[key]=nodePack[key]}return newNodePack};$SCOPE.$NICE_COMMAND={'nc-value':{'commandName':'nc-value','initFunc':function(node,proPath){var node_nc_id=$SCOPE.$NODE_ID_POINT++;var onchangeFun=node.onchange;node.onchange=function(){$SCOPE.$SET_VAL(proPath,node.value);if(onchangeFun){onchangeFun()}};var onfocusFun=node.onfocus;node.onfocus=function(){$SCOPE.$UNREFRESH_NODE_ID=node_nc_id;if(onfocusFun){onfocusFun()}};var onblurFun=node.onblur;node.onblur=function(){$SCOPE.$UNREFRESH_NODE_ID=-1;if(onblurFun){onblurFun()}};$SCOPE.$ADD_V2M_NODE_MAP(proPath,{'id':node_nc_id,'node':node,'expression':proPath,'render':function(proPath,val){this.node.value=val}})}},'nc-for':{'commandName':'nc-for','initFunc':function(node,command){var node_nc_id=$SCOPE.$NODE_ID_POINT++;var flag=command.substring(0,command.indexOf(' in '));flag=flag.replace(/ +/g,'');var proPath=command.substring(command.indexOf(' in ')+4);proPath=proPath.replace(/ +/g,'');var NEW_NODE_MAP={'id':node_nc_id,'node':node,'expression':proPath,'render':function(proPath,val){if(val.length>this.newNodeAry.length){for(var i=this.newNodeAry.length;i<val.length;i++){var newHtml=this.nodeHtml.replace(/nc-for='[^']+'/g,'');newHtml=newHtml.replace(/nc-for="[^"]+"/g,'');var stepLen=flag.length;if(newHtml.indexOf(flag)>=0){var stepIndexAry=[];for(var step=0;step<newHtml.length&&(step+stepLen)<=newHtml.length;step++){var stepStr=newHtml.substring(step,step+stepLen);if(stepStr===flag){var preStr=step>0?newHtml.substring(step-1,step):'';var flagStrReg=/[_0-9a-z-A-Z]/;step=step+stepLen;if(!flagStrReg.test(preStr)){if(step==newHtml.length){stepIndexAry.push(step)}else{var nextStr=newHtml.substring(step,step+1);if(!flagStrReg.test(nextStr)){stepIndexAry.push(step)}}}}}if(stepIndexAry.length>0){var newHtml_='';var start=0;for(var step=0;step<stepIndexAry.length;step++){var end=stepIndexAry[step]-stepLen;newHtml_=newHtml_+newHtml.substring(start,end);newHtml_=newHtml_+proPath+'['+i+']';start=stepIndexAry[step]}newHtml_=newHtml_+newHtml.substring(start);newHtml=newHtml_}}newHtml=newHtml.replace(/\$index/g,i);var lowerNewHtml=newHtml.toLowerCase();var level=1;if(lowerNewHtml.indexOf('<tr')==0){newHtml='<table><tbody>'+newHtml+'</tbody></table>';level=2}else if(lowerNewHtml.indexOf('<option')==0){newHtml='<select>'+newHtml+'</select>';level=1}else if(lowerNewHtml.indexOf('<ul')==0){newHtml='<ul>'+newHtml+'</ul>';level=1}else{level=0}var tmpDiv=document.createElement('div');tmpDiv.innerHTML=newHtml;var newNode=tmpDiv.childNodes[0];for(var j=0;j<level;j++){newNode=newNode.childNodes[0]}if(this.nextSibling){this.parentNode.insertBefore(newNode,this.nextSibling)}else{this.parentNode.appendChild(newNode)}this.newNodeAry.push(newNode);$SCOPE.$INIT_MVVM(newNode)}}else if(val.length<this.newNodeAry.length){var removeNum=this.newNodeAry.length-val.length;for(var i=0;i<removeNum;i++){var removeNode=this.newNodeAry.pop();this.parentNode.removeChild(removeNode)}}},'parentNode':node.parentNode,'nextSibling':node.nextSibling,'newNodeAry':[]};node.parentNode.removeChild(node);var tmpDiv=document.createElement('div');tmpDiv.appendChild(node);var cloneHtml=tmpDiv.innerHTML;NEW_NODE_MAP['nodeHtml']=cloneHtml;$SCOPE.$ADD_V2M_NODE_MAP(proPath,NEW_NODE_MAP)}},'nc-if':{'commandName':'nc-if','initFunc':function(node,expression){if(node.getAttribute('nc-for')){return false}var node_nc_id=$SCOPE.$NODE_ID_POINT++;$SCOPE.$ADD_V2M_NODE_MAP(expression,{'id':node_nc_id,'node':node,'expression':expression,'render':function(expression,val){if(val){if(!this.node.parentNode){if(this.nextSibling){this.parentNode.insertBefore(this.node,this.nextSibling)}else{this.parentNode.appendChild(this.node)}}}else{if(this.node.parentNode){this.node.parentNode.removeChild(this.node)}}},'parentNode':node.parentNode,'nextSibling':node.nextSibling})}}};$SCOPE.$BIND_NODE=function(node){var attributes=node.attributes;if(attributes&&attributes.length>0){for(var i=0;i<attributes.length;i++){var nodeName=attributes[i].nodeName;var nodeValue=attributes[i].nodeValue;if($SCOPE.$NICE_COMMAND[nodeName]){$SCOPE.$NICE_COMMAND[nodeName].initFunc(node,nodeValue)}else{$SCOPE.$BIND_TXT(attributes[i])}}}};$SCOPE.$BIND_TXT=function(node){var content=node.nodeValue;if(!content){return false}var start=content.indexOf('{{');var end=content.indexOf('}}');if(start<0||end<=0){return false}var nodeTxtAry=[];var commandAry=[];var stop=false;for(;!stop;){var first=content.substring(0,start);var second=content.substring(start+2,end);second=second.replace(/\[/g,'.');second=second.replace(/\]/g,'');var filter='';if(second.indexOf('|')>0){filter=second.substring(second.indexOf('|')+1);second=second.substring(0,second.indexOf('|'))}commandAry.push({command:second,filter:filter});var content=content.substring(end+2);start=content.indexOf('{{');end=content.indexOf('}}');nodeTxtAry.push({'name':first,'value':first});nodeTxtAry.push({'name':second,'value':''});if(start<0||end<=0){nodeTxtAry.push({'name':content,'value':content});stop=true}}for(var i=0;i<commandAry.length;i++){$SCOPE.$ADD_V2M_NODE_MAP(commandAry[i].command,{'id':$SCOPE.$NODE_ID_POINT++,'node':node,'expression':commandAry[i].command,'render':function(expression,val){if(this.expressionFilter){val=eval(this.expressionFilter+'(val)')}this.node.nodeValue='';for(var j=0;j<this.nodeTxtAry.length;j++){if(this.nodeTxtAry[j].name==expression){this.nodeTxtAry[j].value=val}this.node.nodeValue=this.node.nodeValue+this.nodeTxtAry[j].value}},'expressionFilter':commandAry[i].filter,'nodeTxtAry':nodeTxtAry})}};$SCOPE.$SET_VAL=function(proPath,val){proPath=proPath.replace(/\[/g,'.');proPath=proPath.replace(/\]/g,'');var pros=proPath.split('.');var obj=$SCOPE.$DATA;for(var i=0;i<pros.length;i++){if(i<pros.length-1){if(!obj[pros[i]]){obj[pros[i]]=new Object()}}else{obj[pros[i]]=val}obj=obj[pros[i]]}};$SCOPE.$GET_VAL=function(proPath){for(var pro in $SCOPE_DATA_){if(proPath.indexOf(pro)>=0){var words=proPath.split(pro);if(words.length>1){var newProPath='';for(var i=0;i<words.length-1;i++){if(words[i].length>0){if(words[i].substring(words[i].length-1)=="."){newProPath=newProPath+words[i]+pro}else{newProPath=newProPath+words[i]+'$SCOPE.$DATA.'+pro}}else{newProPath=newProPath+words[i]+'$SCOPE.$DATA.'+pro}}proPath=newProPath+words[words.length-1]}}else{}}try{var words=proPath.split('.');proPath='';for(var i=0;i<words.length;i++){if(proPath.length>0){if(isNaN(words[i])){proPath=proPath+'.'}else{proPath=proPath+'['}}proPath=proPath+words[i];if(!isNaN(words[i])){proPath=proPath+']'}}var result=eval(proPath);return result}catch(err){return undefined}};$SCOPE.$GET_PRO_SOLID_MAP=function(pKey,DATA,emptyProSolidMap){if(pKey){emptyProSolidMap[pKey]=DATA;pKey=pKey+'.'}else{pKey=''}if(DATA instanceof Object){for(var key in DATA){$SCOPE.$GET_PRO_SOLID_MAP(pKey+key,DATA[key],emptyProSolidMap)}}};$SCOPE.$SYNC_SCOPE_DATA_=function(proSolidMap){var keys={};for(var proPath in proSolidMap){do{if($SCOPE_DATA_[proPath]===undefined&&proSolidMap[proPath]===undefined){break}if($SCOPE_DATA_[proPath]!==undefined&&$SCOPE_DATA_[proPath].value===proSolidMap[proPath]){break}var version=1;if($SCOPE_DATA_[proPath]!==undefined){version=$SCOPE_DATA_[proPath]['version']+1}$SCOPE_DATA_[proPath]={'version':version,'value':proSolidMap[proPath]};keys[proPath]=$SCOPE_DATA_[proPath]['version']}while(false)}for(var proPath in $SCOPE_DATA_){var version=$SCOPE_DATA_[proPath]['version'];do{if(keys[proPath]!==undefined){break}if(proSolidMap[proPath]===undefined){delete $SCOPE_DATA_[proPath];keys[proPath]=version;break}for(var i=0;$SCOPE.$V2M_NODE_MAP[proPath]&&i<$SCOPE.$V2M_NODE_MAP[proPath].length;i++){if($SCOPE.$V2M_NODE_MAP[proPath][i]['version']!==version){keys[proPath]=version;break}if($SCOPE.$V2M_NODE_MAP[proPath][i]['node']['nodeName'].toLowerCase()=='select'){if($SCOPE_DATA_[proPath]){if($SCOPE.$V2M_NODE_MAP[proPath][i]['node'].value!=$SCOPE_DATA_[proPath]['value']){$SCOPE.$V2M_NODE_MAP[proPath][i]['version']=0}}}}}while(false)}var needSyncProPath=new Object();for(var proPath in keys){needSyncProPath[proPath]=keys[proPath];var end=proPath.lastIndexOf('.');while(end>0){proPath=proPath.substring(0,end);needSyncProPath[proPath]=keys[proPath];end=proPath.lastIndexOf('.')}}return needSyncProPath};$SCOPE.$NEED_AFTER_RENDER=true;$SCOPE.$FLUSH=function(){var proSolidMap={};$SCOPE.$GET_PRO_SOLID_MAP(null,$SCOPE.$DATA,proSolidMap);var needSyncProPath=$SCOPE.$SYNC_SCOPE_DATA_(proSolidMap);var needSyncProPathSize=0;for(var proPath in needSyncProPath){needSyncProPathSize++;for(var i=0;$SCOPE.$V2M_NODE_MAP[proPath]!==undefined&&i<$SCOPE.$V2M_NODE_MAP[proPath].length;i++){var nodePack=$SCOPE.$V2M_NODE_MAP[proPath][i];if(nodePack.id==$SCOPE.$UNREFRESH_NODE_ID)continue;nodePack['version']=needSyncProPath[proPath];var val=$SCOPE.$GET_VAL(nodePack.expression);if(val===undefined){val=''}nodePack.render(nodePack.expression,val)}if($WATCH_QUEE[proPath]&&$WATCH_QUEE[proPath].length>0){for(var j=0;j<$WATCH_QUEE[proPath].length;j++){var $watchObj=$WATCH_QUEE[proPath][j];var execStatement='$watchObj.fun(';for(var k=0;k<$watchObj.proPathAry.length;k++){execStatement=execStatement+'$SCOPE.$DATA.'+$watchObj.proPathAry[k]+'';if(k<$watchObj.proPathAry.length-1){execStatement=execStatement+','}}execStatement=execStatement+')';eval(execStatement)}}}if(needSyncProPathSize>0){$SCOPE.$NEED_AFTER_RENDER=true}else{if($SCOPE.$NEED_AFTER_RENDER){$SCOPE.$NEED_AFTER_RENDER=false;if($AFTER_RENDER){$AFTER_RENDER()}}if($AFTER_FLUSH){$AFTER_FLUSH()}}};$SCOPE.$INIT_MVVM=function(node){var total=0;if(node.nodeType==1){$SCOPE.$BIND_NODE(node)}if(node.nodeType==3){$SCOPE.$BIND_TXT(node)}var childrens=node.childNodes;for(var i=0;childrens!==undefined&&i<childrens.length;i++){$SCOPE.$INIT_MVVM(childrens[i])}};$NICE_MVVM=$SCOPE;$SCOPE.$FLUSH();$SCOPE.$INIT_MVVM(document);$SCOPE.$INTERVAL=setInterval(function(){$SCOPE.$FLUSH()},1)};